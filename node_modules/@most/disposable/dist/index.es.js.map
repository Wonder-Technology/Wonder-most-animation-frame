{"version":3,"file":"index.es.js","sources":["../src/dispose.js","../src/disposeNone.js","../src/disposeOnce.js","../src/disposeWith.js","../src/disposeAll.js","../src/tryDispose.js","../src/index.js"],"sourcesContent":["/** @license MIT License (c) copyright 2010-2017 original author or authors */\n\nexport const dispose = disposable =>\n  disposable.dispose()\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\n\nexport const disposeNone = () => NONE\nconst NONE = new (class DisposeNone {\n  dispose () {}\n})()\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\n\n// Wrap an existing disposable (which may not already have been once()d)\n// so that it will only dispose its underlying resource at most once.\nexport const disposeOnce = disposable =>\n  new DisposeOnce(disposable)\n\nclass DisposeOnce {\n  constructor (disposable) {\n    this.disposed = false\n    this.disposable = disposable\n  }\n\n  dispose () {\n    if (!this.disposed) {\n      this.disposed = true\n      this.disposable.dispose()\n      this.disposable = undefined\n    }\n  }\n}\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\nimport { disposeOnce } from './disposeOnce'\nimport { curry2 } from '@most/prelude'\n\n// Create a Disposable that will use the provided\n// dispose function to dispose the resource\nexport const disposeWith = curry2((dispose, resource) =>\n  disposeOnce(new DisposeWith(dispose, resource)))\n\n// Disposable represents a resource that must be\n// disposed/released. It aggregates a function to dispose\n// the resource and a handle to a key/id/handle/reference\n// that identifies the resource\nclass DisposeWith {\n  constructor (dispose, resource) {\n    this._dispose = dispose\n    this._resource = resource\n  }\n\n  dispose () {\n    this._dispose(this._resource)\n  }\n}\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\nimport { reduce, curry2 } from '@most/prelude'\n\n// Aggregate a list of disposables into a DisposeAll\nexport const disposeAll = ds =>\n  new DisposeAll(ds)\n\n// Convenience to aggregate 2 disposables\nexport const disposeBoth = curry2((d1, d2) =>\n  disposeAll([d1, d2]))\n\nclass DisposeAll {\n  constructor (disposables) {\n    this.disposables = disposables\n  }\n\n  dispose () {\n    throwIfErrors(disposeCollectErrors(this.disposables))\n  }\n}\n\n// Dispose all, safely collecting errors into an array\nconst disposeCollectErrors = disposables =>\n  reduce(appendIfError, [], disposables)\n\n// Call dispose and if throws, append thrown error to errors\nconst appendIfError = (errors, d) => {\n  try {\n    d.dispose()\n  } catch (e) {\n    errors.push(e)\n  }\n  return errors\n}\n\n// Throw DisposeAllError if errors is non-empty\nconst throwIfErrors = errors => {\n  if (errors.length > 0) {\n    throw new DisposeAllError(`${errors.length} errors`, errors)\n  }\n}\n\nexport const DisposeAllError = (Error => {\n  function DisposeAllError (message, errors) {\n    Error.call(this, message)\n    this.message = message\n    this.name = DisposeAllError.name\n    this.errors = errors\n\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, DisposeAllError)\n    }\n\n    this.stack = `${this.stack}${formatErrorStacks(this.errors)}`\n  }\n\n  DisposeAllError.prototype = Object.create(Error.prototype)\n\n  return DisposeAllError\n})(Error)\n\nconst formatErrorStacks = errors =>\n  reduce(formatErrorStack, '', errors)\n\nconst formatErrorStack = (s, e, i) =>\n  s + `\\n[${(i + 1)}] ${e.stack}`\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\nimport { curry3 } from '@most/prelude'\n\n// Try to dispose the disposable.  If it throws, send\n// the error to sink.error with the provided Time value\nexport const tryDispose = curry3((t, disposable, sink) => {\n  try {\n    disposable.dispose()\n  } catch (e) {\n    sink.error(t, e)\n  }\n})\n","/** @license MIT License (c) copyright 2010-2017 original author or authors */\n\nexport * from './dispose'\nexport * from './disposeNone'\nexport * from './disposeWith'\nexport * from './disposeOnce'\nexport * from './disposeAll'\nexport * from './tryDispose'\n"],"names":["dispose","disposable","disposeNone","NONE","disposeOnce","DisposeOnce","disposed","undefined","disposeWith","curry2","resource","DisposeWith","_dispose","_resource","disposeAll","DisposeAll","ds","disposeBoth","d1","d2","disposables","disposeCollectErrors","reduce","appendIfError","errors","d","e","push","throwIfErrors","length","DisposeAllError","message","call","name","Error","captureStackTrace","stack","formatErrorStacks","prototype","Object","create","formatErrorStack","s","i","tryDispose","curry3","t","sink","error"],"mappings":";;AAAA;;AAEA,AAAO,IAAMA,UAAU,SAAVA,OAAU;SACrBC,WAAWD,OAAX,EADqB;CAAhB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACFP;;AAEA,AAAO,IAAME,cAAc,SAAdA,WAAc;SAAMC,IAAN;CAApB;AACP,IAAMA,oBAAO;;;;;wBACXH,OADW,sBACA,EADA;;;MAAb;;ACHA;;;;AAIA,AAAO,IAAMI,cAAc,SAAdA,WAAc;SACzB,IAAIC,WAAJ,CAAgBJ,UAAhB,CADyB;CAApB;;IAGDI;uBACSJ,UAAb,EAAyB;;;SAClBK,QAAL,GAAgB,KAAhB;SACKL,UAAL,GAAkBA,UAAlB;;;wBAGFD,6BAAW;QACL,CAAC,KAAKM,QAAV,EAAoB;WACbA,QAAL,GAAgB,IAAhB;WACKL,UAAL,CAAgBD,OAAhB;WACKC,UAAL,GAAkBM,SAAlB;;;;;;;ACjBN;AACA,AAGA;;AAEA,AAAO,IAAMC,2BAAcC,OAAO,UAACT,OAAD,EAAUU,QAAV;SAChCN,YAAY,IAAIO,WAAJ,CAAgBX,OAAhB,EAAyBU,QAAzB,CAAZ,CADgC;CAAP,CAApB;;;;;;;IAODC;uBACSX,OAAb,EAAsBU,QAAtB,EAAgC;;;SACzBE,QAAL,GAAgBZ,OAAhB;SACKa,SAAL,GAAiBH,QAAjB;;;wBAGFV,6BAAW;SACJY,QAAL,CAAc,KAAKC,SAAnB;;;;;;ACpBJ;AACA,AAEA;AACA,AAAO,IAAMC,aAAa,SAAbA,UAAa;SACxB,IAAIC,UAAJ,CAAeC,EAAf,CADwB;CAAnB;;;AAIP,AAAO,IAAMC,2BAAcR,OAAO,UAACS,EAAD,EAAKC,EAAL;SAChCL,WAAW,CAACI,EAAD,EAAKC,EAAL,CAAX,CADgC;CAAP,CAApB;;IAGDJ;sBACSK,WAAb,EAA0B;;;SACnBA,WAAL,GAAmBA,WAAnB;;;uBAGFpB,6BAAW;kBACKqB,qBAAqB,KAAKD,WAA1B,CAAd;;;;;;;;;AAKJ,IAAMC,uBAAuB,SAAvBA,oBAAuB;SAC3BC,OAAOC,aAAP,EAAsB,EAAtB,EAA0BH,WAA1B,CAD2B;CAA7B;;;AAIA,IAAMG,gBAAgB,SAAhBA,aAAgB,CAACC,MAAD,EAASC,CAAT,EAAe;MAC/B;MACAzB,OAAF;GADF,CAEE,OAAO0B,CAAP,EAAU;WACHC,IAAP,CAAYD,CAAZ;;SAEKF,MAAP;CANF;;;AAUA,IAAMI,gBAAgB,SAAhBA,aAAgB,SAAU;MAC1BJ,OAAOK,MAAP,GAAgB,CAApB,EAAuB;UACf,IAAIC,eAAJ,CAAuBN,OAAOK,MAA9B,cAA+CL,MAA/C,CAAN;;CAFJ;;AAMA,AAAO,IAAMM,+BAAmB,iBAAS;WAC9BA,eAAT,CAA0BC,OAA1B,EAAmCP,MAAnC,EAA2C;UACnCQ,IAAN,CAAW,IAAX,EAAiBD,OAAjB;SACKA,OAAL,GAAeA,OAAf;SACKE,IAAL,GAAYH,gBAAgBG,IAA5B;SACKT,MAAL,GAAcA,MAAd;;QAEIU,MAAMC,iBAAV,EAA6B;YACrBA,iBAAN,CAAwB,IAAxB,EAA8BL,eAA9B;;;SAGGM,KAAL,QAAgB,KAAKA,KAArB,GAA6BC,kBAAkB,KAAKb,MAAvB,CAA7B;;;kBAGcc,SAAhB,gBAA4BC,OAAOC,MAAP,CAAcN,MAAMI,SAApB,CAA5B;;SAEOR,eAAP;CAhB6B,CAiB5BI,KAjB4B,CAAxB;;AAmBP,IAAMG,oBAAoB,SAApBA,iBAAoB;SACxBf,OAAOmB,gBAAP,EAAyB,EAAzB,EAA6BjB,MAA7B,CADwB;CAA1B;;AAGA,IAAMiB,mBAAmB,SAAnBA,gBAAmB,CAACC,CAAD,EAAIhB,CAAJ,EAAOiB,CAAP;SACvBD,cAAWC,IAAI,CAAf,WAAsBjB,EAAEU,KAAxB,CADuB;CAAzB;;AChEA;AACA,AAEA;;AAEA,AAAO,IAAMQ,0BAAaC,OAAO,UAACC,CAAD,EAAI7C,UAAJ,EAAgB8C,IAAhB,EAAyB;MACpD;eACS/C,OAAX;GADF,CAEE,OAAO0B,CAAP,EAAU;SACLsB,KAAL,CAAWF,CAAX,EAAcpB,CAAd;;CAJsB,CAAnB;;ACLP;;;;"}